name: CD Pipeline

on:
  workflow_run:
    workflows: ["CI Pipeline"]
    types:
      - completed

  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest   # âœ… GitHub-hosted runner

    steps:
    - name: Deploy to EC2 via SSH
      uses: appleboy/ssh-action@v0.1.7
      with:
        host: ${{ secrets.EC2_HOST }}
        username: ${{ secrets.EC2_USER }}
        key: ${{ secrets.EC2_KEY }}
        script: |
          sudo docker pull jaygohel/cicd-pipeline:latest
          sudo docker rm -f cicd-pipeline-container || true
          sudo docker run -d -p 8080:8080 --name cicd-pipeline-container jaygohel/cicd-pipeline:latest
